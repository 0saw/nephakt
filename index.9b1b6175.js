function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},i=t.parcelRequirebe25;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){r[e]=t},t.parcelRequirebe25=i),i.register("1X5mI",(function(t,n){var r,i;e(t.exports,"register",(function(){return r}),(function(e){return r=e})),e(t.exports,"resolve",(function(){return i}),(function(e){return i=e}));var s={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)s[t[n]]=e[t[n]]},i=function(e){var t=s[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),i("1X5mI").register(JSON.parse('{"jFg1u":"index.9b1b6175.js","hEwHo":"imdb.7bd187a1.svg","gGD6r":"no-image.9af9ecce.svg"}'));const s=e=>{const t=[],n=e=>{t.push(e)},r=()=>{t.forEach((t=>{t(e)}))},i=e=>({get:function(t,r){return"_isProxy"===r||("subscribe"===r?n:(["object","array"].includes(Object.prototype.toString.call(t[r]).slice(8,-1).toLowerCase())&&!1===t[r]._isProxy&&Reflect.set(t,r,new Proxy(t[r],i(e))),t[r]))},set:function(e,t,n){return e[t]===n||(Reflect.set(e,t,n),r()),!0},deleteProperty:function(e,t){return Reflect.deleteProperty(e,t),r(),!0}});return new Proxy(e,i(e))},a=/^#(?<path>[^?]+)\??(?<search>.*)?$/,o=()=>{const e=window.location.hash.match(a);if(null===e||void 0===e.groups)return{path:"",search:"",searchParams:new URLSearchParams("")};try{const t=new URLSearchParams(e.groups.search);return{path:e.groups.path??"",search:t.toString(),searchParams:t}}catch(t){return{path:e.groups.path??"",search:"",searchParams:new URLSearchParams("")}}},l=e=>{const t=o();let{path:n=t.path,searchParams:r=t.searchParams}=e;void 0!==e.search&&(r=new URLSearchParams(e.search)),""===r.toString()?window.location.hash=n:window.location.hash=`${n}?${r.toString()}`},c=s({items:[]}),u=c.subscribe,d=()=>{c.items=p()},g="nephakt-history",p=()=>{try{const e=window.localStorage.getItem(g);if(null===e)return[];const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0&&"title"in t[0]&&"id"in t[0]&&"originalTitle"in t[0])return t}catch(e){}return[]},h=e=>{window.localStorage.setItem(g,JSON.stringify(e.slice(0,100)))};const m=new Error("ошибка при обращении к серверу"),f=async e=>{const t=new URL(`https://api.themoviedb.org/3${e}`);return t.searchParams.set("api_key","ea7eeb0ab576c928d67324277033d709"),t.searchParams.set("language","ru-RU"),await fetch(t).then((e=>{if(e.ok)return e;throw m})).then((async e=>await e.json()))},v=function(e,t,n){var r,i,s;void 0===t&&(t=50),void 0===n&&(n={});var a=null!=(r=n.isImmediate)&&r,o=null!=(i=n.callback)&&i,l=n.maxWait,c=Date.now(),u=[];function d(){if(void 0!==l){var e=Date.now()-c;if(e+t>=l)return l-e}return t}var g=function(){var t=[].slice.call(arguments),n=this;return new Promise((function(r,i){var l=a&&void 0===s;if(void 0!==s&&clearTimeout(s),s=setTimeout((function(){if(s=void 0,c=Date.now(),!a){var r=e.apply(n,t);o&&o(r),u.forEach((function(e){return(0,e.resolve)(r)})),u=[]}}),d()),l){var g=e.apply(n,t);return o&&o(g),r(g)}u.push({resolve:r,reject:i})}))};return g.cancel=function(e){void 0!==s&&clearTimeout(s),u.forEach((function(t){return(0,t.reject)(e)})),u=[]},g}((async e=>await f(`/search/movie?query=${e}`)),300),w=async e=>await f(`/movie/${e}`),y=s({isSuggestFocused:!1,inputValue:o().searchParams.get("q")??"",lastInputValue:"",suggestions:[]}),b=y.subscribe,$=async()=>{if(y.lastInputValue!==y.inputValue)if(y.lastInputValue=y.inputValue,v.cancel("abort"),""!==y.inputValue.trim())try{const{results:e}=await v(y.inputValue);y.suggestions=e}catch(e){if("abort"!==e)throw e}else y.suggestions=[]},S=e=>e.replaceAll(/\W/g,"").toLowerCase(),x=()=>{const e=S(y.inputValue),t=c.items.filter((t=>S(t.title).includes(e)||S(t.originalTitle).includes(e))).slice(0,5).map((e=>({type:"history",title:`${e.title}${""!==e.originalTitle?` (${e.originalTitle})`:""}`,value:e.id,rawTitle:e.title,originalTitle:e.originalTitle}))),n=t.map((e=>e.value)),r=y.suggestions.filter((e=>!n.includes(e.id))).slice(0,10-t.length).map((e=>{const t=[];return""!==e.original_title&&e.original_title!==e.title&&t.push(e.original_title),""!==e.release_date&&void 0!==e.release_date.split("-")[0]&&t.push(e.release_date.split("-")[0]),{type:"search",title:`${e.title}${t.length>0?` (${t.join(", ")})`:""}`,value:e.id,rawTitle:e.title,originalTitle:e.original_title}}));return[...t,...r]},L=s({item:null}),E=L.subscribe,T=async e=>{try{const t=await w(e);if("success"in t&&!t.success)return void(L.item=null);if(!("id"in t))return;L.item={genres:t.genres,id:t.id,imdbId:t.imdb_id,tagline:t.tagline,originalTitle:t.original_title,overview:t.overview,title:t.title,posterPath:t.poster_path,year:t.release_date.split("-")[0]}}catch(e){L.item=null,console.error("Произошла ошибка при запросе данных")}},P=()=>{L.item=null};var _;_=new URL(i("1X5mI").resolve("hEwHo"),import.meta.url).toString();const k=new URL(_);var j;j=new URL(i("1X5mI").resolve("gGD6r"),import.meta.url).toString();const R=new URL(j);(()=>{const e=document.querySelector(".js-history"),t=document.querySelector(".js-history-list");if(null===e||null===t)return;const n=()=>{const{search:n}=o();e.style.display=0===c.items.length?"none":"",t.innerHTML=c.items.slice(0,3).map((({title:e,id:t})=>`\n        <li>\n          <a\n            class="block outline-none text-emerald-600 hover:text-emerald-500 focus-visible:text-emerald-500"\n            href="#/movie/${t}${""!==n?`?${n}`:""}"\n          >${e}</a>\n        </li>\n      `)).join("")};window.addEventListener("storage",d),d(),b(n),u(n),n()})(),(()=>{const e=document.querySelector(".js-suggest-form"),t=document.querySelector(".js-suggest-clear"),n=document.querySelector(".js-suggest-input"),r=document.querySelector(".js-suggest-options");if(null===e||null===t||null===n||null===r)return;const i=()=>{const{isSuggestFocused:e,inputValue:t,suggestions:i}=y,{search:s}=o();n.value=t,r.style.display=e&&0!==i.length?"":"none",r.innerHTML=x().map((e=>`\n        <li>\n          <a \n            class="block px-3 py-1 focus-visible:bg-slate-100 hover:bg-slate-100${"history"===e.type?" text-purple-800":""}"\n            href="#/movie/${e.value}${""!==s?`?${s}`:""}"\n          >${e.title}</a>\n        </li>\n      `)).join("")};e.addEventListener("submit",(e=>{e.preventDefault()})),t.addEventListener("click",(()=>{y.inputValue="",y.suggestions=[],y.isSuggestFocused=!1,l({search:""})})),n.addEventListener("input",(async({currentTarget:e})=>{e instanceof HTMLInputElement&&(y.inputValue=e.value,l({search:""!==e.value.trim()?`q=${e.value}`:""}),await $())})),n.addEventListener("click",$),e.addEventListener("keydown",(e=>{const t=Array.prototype.indexOf.call(r.children,document.activeElement?.closest("li"));let n=t;"ArrowUp"===e.key?n=Math.max(0,n-1):"ArrowDown"===e.key?n=Math.min(r.children.length-1,n+1):"Escape"===e.key&&(y.isSuggestFocused=!1),t!==n&&["ArrowUp","ArrowDown"].includes(e.key)&&r.children[n]?.querySelector("a")?.focus()})),n.addEventListener("focus",(()=>{y.isSuggestFocused=!0})),document.addEventListener("click",(t=>{if(!y.isSuggestFocused)return;const n=t.target instanceof Node&&e.contains(t.target);y.isSuggestFocused!==n&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),y.isSuggestFocused=n)})),r.addEventListener("click",(e=>{if(!(e.target instanceof Element))return;const t=e.target.closest("li");if(null===t)return;const n=Array.prototype.indexOf.call(r.children,t),i=x();if(void 0!==i[n]){const{rawTitle:e,value:t,originalTitle:r}=i[n];(e=>{const t=[...c.items],n=t.findIndex((t=>t.id===e.id));-1!==n&&t.splice(n,1),t.unshift(e),c.items=t,h(t)})({title:e,id:t,originalTitle:r})}y.isSuggestFocused=!1})),u(i),b(i),i()})(),(()=>{const e=document.querySelector(".js-detail");if(null===e)return;const t=()=>{const{item:t}=L;if(null===t)return void(e.innerHTML="");const{genres:n,imdbId:r,title:i,overview:s,tagline:a,posterPath:o,year:l}=t;e.innerHTML=`\n      ${""!==o?`\n          <a class="hidden md:block" href="https://image.tmdb.org/t/p/original${o}" target="_blank" rel="nofollow noopener">\n            <img \n              class="rounded" src="https://image.tmdb.org/t/p/w300${o}" \n              alt="постер к фильму ${i}" \n              onerror="this.src = '${R.toString()}'"\n            />\n          </a>\n        `:""}\n      \n      <div class="prose prose-slate">\n        <h1 class="mb-0">${i}${""!==l?` (${l})`:""}</h1>\n      \n        ${""!==a?`<blockquote class="my-2">${a}</blockquote>`:""}\n      \n        ${""!==s?`<p>${s}</p>`:""}\n      \n        ${n.length>0?`\n            <div class="my-4 flex flex-wrap gap-2">\n              Жанры:\n              ${n.map((({name:e})=>`\n                <div class="rounded border border-slate-300 bg-slate-200 px-2">${e}</div>\n              `)).join("")}\n            </div>\n          `:""}\n        \n        ${""!==r?`\n            <div class="my-4 flex flex-wrap gap-2 not-prose">\n              <a href="https://www.imdb.com/title/${r}/" target="_blank" rel="noopener nofollow">\n                <img src="${k.toString()}" alt="">\n              </a>\n            </div>\n          `:""}\n      </div>\n    `},n=async()=>{const{path:e}=o(),t=e.match(/^\/movie\/(\d+)/);if(null===t||t.length<=1)return void P();const n=parseInt(t[1],10);Number.isNaN(n)?P():await T(n)};window.addEventListener("hashchange",n),n(),E(t),t()})();
//# sourceMappingURL=index.9b1b6175.js.map
